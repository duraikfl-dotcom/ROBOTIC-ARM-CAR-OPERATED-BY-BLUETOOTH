// Including libraries
#include <Servo.h>

// Defining servo motor pins
Servo servo1;
Servo servo2;
Servo servo3;

int servo1Pin = 9;
int servo2Pin = 10;
int servo3Pin = 11;

// Defining DC motor pins
int motor1_in1 = 2;
int motor1_in2 = 3;
int motor1_ena = 6; // PWM pin

int motor2_in3 = 4;
int motor2_in4 = 5;
int motor2_enb = 7; // PWM pin

// Variables for Bluetooth communication
char command;

void setup() {
  // Starting serial communication (for Bluetooth data)
  Serial.begin(9600);

  // Setting servo motor pins as output
  servo1.attach(servo1Pin);
  servo2.attach(servo2Pin);
  servo3.attach(servo3Pin);

  // Setting DC motor pins as output
  pinMode(motor1_in1, OUTPUT);
  pinMode(motor1_in2, OUTPUT);
  pinMode(motor1_ena, OUTPUT);
  pinMode(motor2_in3, OUTPUT);
  pinMode(motor2_in4, OUTPUT);
  pinMode(motor2_enb, OUTPUT);

  // Setting motors to stop at start
  stopMotors();

  // Setting servos to initial position (you can change this)
  servo1.write(90);
  servo2.write(90);
  servo3.write(90);
}

void loop() {
  // Reading data from Bluetooth when available
  if (Serial.available() > 0) {
    command = Serial.read();
    processCommand(command);
  }
}

// Function to stop motors
void stopMotors() {
  digitalWrite(motor1_in1, LOW);
  digitalWrite(motor1_in2, LOW);
  analogWrite(motor1_ena, 0);

  digitalWrite(motor2_in3, LOW);
  digitalWrite(motor2_in4, LOW);
  analogWrite(motor2_enb, 0);
}

// Function to process commands (modify this based on your need)
void processCommand(char cmd) {
  switch (cmd) {

    // Car movement control
    case 'F': // Move forward
      forward();
      break;

    case 'B': // Move backward
      backward();
      break;

    case 'L': // Turn left
      left();
      break;

    case 'R': // Turn right
      right();
      break;

    case 'S': // Stop
      stopMotors();
      break;

    // Servo control (modify based on your arm movements)
    case '1':
      servo1.write(0);
      break;

    case '2':
      servo1.write(90);
      break;

    case '3':
      servo1.write(180);
      break;

    case '4':
      servo2.write(0);
      break;

    case '5':
      servo2.write(90);
      break;

    case '6':
      servo2.write(180);
      break;

    case '7':
      servo3.write(0);
      break;

    case '8':
      servo3.write(90);
      break;

    case '9':
      servo3.write(180);
      break;
  }
}

// Car movement functions (change based on your wiring)
void forward() {
  digitalWrite(motor1_in1, HIGH);
  digitalWrite(motor1_in2, LOW);
  analogWrite(motor1_ena, 255); // Full speed

  digitalWrite(motor2_in3, HIGH);
  digitalWrite(motor2_in4, LOW);
  analogWrite(motor2_enb, 255); // Full speed
}

void backward() {
  digitalWrite(motor1_in1, LOW);
  digitalWrite(motor1_in2, HIGH);
  analogWrite(motor1_ena, 255);

  digitalWrite(motor2_in3, LOW);
  digitalWrite(motor2_in4, HIGH);
  analogWrite(motor2_enb, 255);
}

void left() {
  digitalWrite(motor1_in1, HIGH);
  digitalWrite(motor1_in2, LOW);
  analogWrite(motor1_ena, 200); // Slightly slower speed

  digitalWrite(motor2_in3, LOW);
  digitalWrite(motor2_in4, HIGH);
  analogWrite(motor2_enb, 200);
}

void right() {
  digitalWrite(motor1_in1, LOW);
  digitalWrite(motor1_in2, HIGH);
  analogWrite(motor1_ena, 200);

  digitalWrite(motor2_in3, HIGH);
  digitalWrite(motor2_in4, LOW);
  analogWrite(motor2_enb, 200);
}
